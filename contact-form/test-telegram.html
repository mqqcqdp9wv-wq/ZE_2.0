<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Telegram Integration</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/contact-form.css">
  <style>
    body {
      padding: 50px;
      background: #f5f5f5;
    }
    .test-container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }
    .status-message {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      display: none;
    }
    .status-success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }
    .status-error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }
    .test-info {
      background: #e7f3ff;
      border: 1px solid #b3d9ff;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  
  <div class="test-container">
    <h2>üß™ –¢–µ—Å—Ç Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</h2>
    <p class="text-muted">–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–æ–∫ –≤ Telegram</p>
    
    <div class="test-info">
      <strong>üì± Bot:</strong> @ze_studio48bid_bot<br>
      <strong>üîë Token:</strong> 8223297194:AAG***<br>
      <strong>üìç Chat ID:</strong> <span id="chat-id-display">8141249044 (–í–ª–∞–¥–∏—Å–ª–∞–≤)</span>
    </div>
    
    <hr>
    
    <!-- –¢–µ—Å—Ç–æ–≤–∞—è —Ñ–æ—Ä–º–∞ -->
    <form id="test-form">
      <h5 class="mb-3">–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ –∑–∞–ø–∏—Å—å</h5>
      
      <div class="form-group">
        <label>–ò–º—è *</label>
        <input type="text" name="name" class="form-control" value="–¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç" required>
      </div>
      
      <div class="form-group">
        <label>–¢–µ–ª–µ—Ñ–æ–Ω *</label>
        <input type="tel" name="phone" class="form-control phone-mask" value="+7 (900) 123-45-67" required>
      </div>
      
      <div class="form-group">
        <label>–ê–≤—Ç–æ–º–æ–±–∏–ª—å *</label>
        <input type="text" name="car" class="form-control" value="BMW X5 2022" required>
      </div>
      
      <div class="form-group">
        <label>–£—Å–ª—É–≥–∞</label>
        <select name="service" class="form-control">
          <option value="–ü–æ–ª–Ω–∞—è —Ç–æ–Ω–∏—Ä–æ–≤–∫–∞">–ü–æ–ª–Ω–∞—è —Ç–æ–Ω–∏—Ä–æ–≤–∫–∞</option>
          <option value="–ü–µ—Ä–µ–¥–Ω–∏–µ —Å—Ç—ë–∫–ª–∞">–ü–µ—Ä–µ–¥–Ω–∏–µ —Å—Ç—ë–∫–ª–∞</option>
          <option value="–ó–∞–¥–Ω–∏–µ —Å—Ç—ë–∫–ª–∞">–ó–∞–¥–Ω–∏–µ —Å—Ç—ë–∫–ª–∞</option>
          <option value="–¢–æ–ª—å–∫–æ –∑–∞–¥–Ω–µ–µ —Å—Ç–µ–∫–ª–æ">–¢–æ–ª—å–∫–æ –∑–∞–¥–Ω–µ–µ —Å—Ç–µ–∫–ª–æ</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
        <textarea name="comment" class="form-control" rows="3">–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</textarea>
      </div>
      
      <button type="submit" class="btn btn-primary btn-block" id="submit-btn">
        üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç –≤ Telegram
      </button>
    </form>
    
    <!-- –°—Ç–∞—Ç—É—Å —Å–æ–æ–±—â–µ–Ω–∏—è -->
    <div id="status-message" class="status-message"></div>
    
    <!-- –õ–æ–≥ –æ—Ç–≤–µ—Ç–∞ -->
    <div class="mt-4">
      <h6>üìã –õ–æ–≥ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:</h6>
      <pre id="response-log" style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-size: 12px; max-height: 300px; overflow-y: auto;"></pre>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // Phone mask
    $('.phone-mask').on('input', function() {
      let value = this.value.replace(/\D/g, '');
      if (value.length > 0 && value[0] !== '7') {
        value = '7' + value;
      }
      if (value.length > 11) {
        value = value.slice(0, 11);
      }
      
      let formatted = '+7';
      if (value.length > 1) {
        formatted += ' (' + value.slice(1, 4);
      }
      if (value.length >= 5) {
        formatted += ') ' + value.slice(4, 7);
      }
      if (value.length >= 8) {
        formatted += '-' + value.slice(7, 9);
      }
      if (value.length >= 10) {
        formatted += '-' + value.slice(9, 11);
      }
      
      this.value = formatted;
    });
    
    // Form submit
    $('#test-form').on('submit', function(e) {
      e.preventDefault();
      
      const submitBtn = $('#submit-btn');
      const statusMsg = $('#status-message');
      const responseLog = $('#response-log');
      
      // Disable button
      submitBtn.prop('disabled', true).text('‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...');
      statusMsg.hide();
      responseLog.text('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...');
      
      // Collect form data
      const formData = {
        goal: '–ó–∞–ø–∏—Å—å –Ω–∞ —Ç–æ–Ω–∏—Ä–æ–≤–∫—É (–¢–ï–°–¢)',
        name: $('input[name="name"]').val(),
        phone: $('input[name="phone"]').val(),
        car: $('input[name="car"]').val(),
        service: $('select[name="service"]').val(),
        comment: $('textarea[name="comment"]').val(),
        timestamp: new Date().toLocaleString('ru-RU')
      };
      
      console.log('Sending data:', formData);
      responseLog.text(JSON.stringify(formData, null, 2));
      
      // Send to backend
      $.ajax({
        url: 'https://9001-itdase4sprh4qjvfj3yg6-0e616f0a.sandbox.novita.ai',
        method: 'POST',
        data: JSON.stringify(formData),
        contentType: 'application/json',
        dataType: 'json',
        success: function(response) {
          console.log('Success:', response);
          responseLog.text(JSON.stringify(response, null, 2));
          
          if (response.success) {
            statusMsg
              .removeClass('status-error')
              .addClass('status-success')
              .html('‚úÖ <strong>–£—Å–ø–µ—Ö!</strong> –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram')
              .show();
          } else {
            statusMsg
              .removeClass('status-success')
              .addClass('status-error')
              .html('‚ùå <strong>–û—à–∏–±–∫–∞:</strong> ' + (response.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'))
              .show();
          }
          
          submitBtn.prop('disabled', false).text('üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç –≤ Telegram');
        },
        error: function(xhr, status, error) {
          console.error('Error:', error);
          responseLog.text('Error: ' + error + '\n\nStatus: ' + status + '\n\nResponse: ' + xhr.responseText);
          
          statusMsg
            .removeClass('status-success')
            .addClass('status-error')
            .html('‚ùå <strong>–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:</strong> ' + error)
            .show();
          
          submitBtn.prop('disabled', false).text('üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç –≤ Telegram');
        }
      });
    });
  </script>
</body>
</html>
